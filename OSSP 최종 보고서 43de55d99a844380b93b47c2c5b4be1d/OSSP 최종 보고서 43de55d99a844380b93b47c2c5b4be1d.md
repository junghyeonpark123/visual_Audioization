# OSSP ìµœì¢… ë³´ê³ ì„œ

ë¶„ë°˜: 02ë¶„ë°˜

                                                                                            

                                                                                 ã€€ã€€ã€€ í•™ê³¼: ì»´í“¨í„° ê³µí•™ê³¼

                                                                                 ã€€ã€€ã€€ ì„±ëª…: ë°•ì •í˜„

### ì£¼ì œ

- ì‹œê°ì˜ ì²­ê°í™” (visual audioization)

      ëª…í™”ë¥¼ ìŒì•…ìœ¼ë¡œ

### í•„ìš”ì„± ë° ê¸°ëŒ€íš¨ê³¼

ì‹œê° ì¥ì• ì¸ë“¤ì´ ê·¸ë¦¼ì„ ë³´ëŠ” ëŒ€ì‹  ë“¤ì„ ìˆ˜ ìˆë„ë¡ í•¨.

ì¼ë°˜ ì‚¬ìš©ìë“¤ì€ ì›í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì…ë ¥í•¨ìœ¼ë¡œì¨ ì—°ìƒ ë˜ëŠ” ë©œë¡œë””ì˜ ìŒì•…ì„ ì¶œë ¥ í•  ìˆ˜ ìˆìŒ.

### ì§„í–‰ê³¼ì •( ê¹ƒë©+ê¹ƒí—ˆë¸Œì˜ íˆìŠ¤í† ë¦¬ ê¸°ì¤€): ë³¸ì¸ ê¹ƒë© ì£¼ì†Œ ê¸°ë¡

[http://sw-git.chosun.ac.kr:8091/junghyeonpark/20194475.git](http://sw-git.chosun.ac.kr:8091/junghyeonpark/20194475.git)

### ì‚¬ìš© ë¼ì´ì„¼ìŠ¤

Opencv ë¼ì´ë¸ŒëŸ¬ë¦¬ - apache 2.0

Magenta ë¼ì´ë¸ŒëŸ¬ë¦¬ - apache 2.0

### ì‹¤í–‰ ê³¼ì • ë° ê²°ê³¼(ì…ì¶œë ¥ í™”ë©´ or ì‹¤í–‰ ê²°ê³¼)

![capture1.jpg](OSSP%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%20%E1%84%87%E1%85%A9%E1%84%80%E1%85%A9%E1%84%89%E1%85%A5%2043de55d99a844380b93b47c2c5b4be1d/capture1.jpg)

â†ªï¸ image resizing ì´í›„ ê²°ê³¼ ì´ë¯¸ì§€

![capture4.jpg](OSSP%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%20%E1%84%87%E1%85%A9%E1%84%80%E1%85%A9%E1%84%89%E1%85%A5%2043de55d99a844380b93b47c2c5b4be1d/capture4.jpg)

â†ªï¸ note-sequence ìƒì„±ì„ ìœ„í•œ ì„¤ì¹˜ ì½”ë“œ ì‹¤í–‰ ì´ë¯¸ì§€

![capture2.jpg](OSSP%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%20%E1%84%87%E1%85%A9%E1%84%80%E1%85%A9%E1%84%89%E1%85%A5%2043de55d99a844380b93b47c2c5b4be1d/capture2.jpg)

â†ªï¸ note-sequence ìƒì„± ê²°ê³¼

![capture5.jpg](OSSP%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%20%E1%84%87%E1%85%A9%E1%84%80%E1%85%A9%E1%84%89%E1%85%A5%2043de55d99a844380b93b47c2c5b4be1d/capture5.jpg)

â†ªï¸ RNNì„ ì´ìš©í•œ ë©œë¡œë”” ë³€í˜•ì„ ìœ„í•œ ì„¤ì¹˜ ì½”ë“œ ê²°ê³¼

![capture3.jpg](OSSP%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%20%E1%84%87%E1%85%A9%E1%84%80%E1%85%A9%E1%84%89%E1%85%A5%2043de55d99a844380b93b47c2c5b4be1d/capture3.jpg)

â†ªï¸ RNNì„ ì´ìš©í•œ note-sequenceë³€í˜• ê²°ê³¼

### ì°¸ê³  ì˜¤í”ˆì†ŒìŠ¤

**Magenta tutorial**

[https://colab.research.google.com/notebooks/magenta/hello_magenta/hello_magenta.ipynb](https://colab.research.google.com/notebooks/magenta/hello_magenta/hello_magenta.ipynb)

### ì°¸ê³  ì§€ì‹

ğŸ”¸**Hue, Saturation, Value**

H â¡ï¸ ìƒ‰ìƒ â¡ï¸ 0~360 â¡ï¸ opencvì—ì„œëŠ” 1/2ê°’ì¸ 0~180ë§Œ ì‚¬ìš© â¡ï¸ 0ì— ê°€ê¹Œìš¸ ìˆ˜ë¡ ì¥íŒŒì¥

S â¡ï¸ ì±„ë„ â¡ï¸ ìƒ‰ì˜ ì§„í•˜ê¸°  â¡ï¸ opencvê¸°ì¤€ 0~255 â¡ï¸ ê°’ì´ í´ ìˆ˜ë¡ ê³ ì±„ë„

V â¡ï¸ ëª…ë„ â¡ï¸ ìƒ‰ì˜ ë°ê¸° â¡ï¸ opencv ê¸°ì¤€ 0~255 â¡ï¸ ê°’ì´ í´ ìˆ˜ë¡ ê³ ëª…ë„

ğŸ”¸**ìƒ‰ìƒê³¼ ê°ì •ì˜ ìƒê´€ê´€ê³„**

ì¥íŒŒì¥(ë‚œìƒ‰), ê³ ì±„ë„, ê³ ëª…ë„ì¼ ìˆ˜ë¡ ë¹ ë¥¸ ì‹œê°„ê°ê³¼ ë¹„ë¡€í•œë‹¤.

ì¥íŒŒì¥(ë‚œìƒ‰), ê³ ì±„ë„, ê³ ëª…ë„ì¼ ìˆ˜ë¡ í¥ë¶„ê°ì„ ë¶ˆëŸ¬ì¼ìœ¼í‚¨ë‹¤.

ğŸ”¸ptich? Midiì—ì„œ ìŒì˜ ë†’ë‚®ì´ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

ğŸ”¸velocity? ë³¼ë¥¨ í¬ê¸°

### ì½”ë“œ ì‘ì„± ë° ë³€ê²½ ë¶€ë¶„

```python
<opencvë¥¼ ì´ìš©í•œ H,S,V ë¶„ë¦¬, ì´ë¯¸ì§€ Resizing>

import cv2
from google.colab.patches import cv2_imshow
import numpy as np

src = cv2.imread('/content/sample_data/sample3.jpeg')
cv2_imshow(src)
print(src.shape)

src2 = cv2.resize(src,(10,3),interpolation=cv2.INTER_LANCZOS4)
print(src2.shape)

hsv = cv2.cvtColor(src2, cv2.COLOR_BGR2HSV)
h,s,v = cv2.split(hsv)
```

```python
<ìƒ‰ìƒì€ ì¥íŒŒ,ì¤‘íŒŒ,ë‹¨íŒŒ 3ê°€ì§€ ì˜ì—­ìœ¼ë¡œ, ì±„ë„ì™€ ëª…ë„ëŠ” ê°ê° 2ê°€ì§€ ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆ„ì–´
ìƒ‰ìƒ,ì±„ë„,ëª…ë„ ìˆœìœ¼ë¡œ ìš°ì„ ì‹œí•˜ì—¬ 12ê°œì˜ ì˜ì—­ì— 0.2ì´ˆë¶€í„° 1.3ê¹Œì§€ 0.1ì´ˆ ê°„ê²©ìœ¼ë¡œ
 ë§¤ì¹­í•œ ì½”ë“œ>

from note_seq.protobuf import music_pb2

my_music = music_pb2.NoteSequence()

r_arr = np.zeros((3,10))  # r_arr => running time =  end_time - start_time 
#print(r_arr)

for j in range (0,3):
  for i in range (0,10):
    if (0<= h[j][i] <=25) or ( 155<= h[j][i] <= 180):   # h1
      if 128 <= s[j][i] <= 255:
        if 128 <= v[j][i] <=255:
          r_arr[j][i] = 0.2
        else:                 # 0 <= v[0][i] <= 127
          r_arr[j][i]=0.3
      else:                   # 0<= s[0][i] <=127
        if 128 <= v[j][i] <=255:
          r_arr[j][i] = 0.4
        else:                 # 0 <= v[0][i] <= 127
          r_arr[j][i]=0.5
      
    elif (26<= h[j][i] <=85):   # h2
      if 128 <= s[j][i] <= 255:
        if 128 <= v[j][i] <=255:
          r_arr[j][i] = 0.6
        else:                 
          r_arr[j][i]=0.7
      else:                   
        if 128 <= v[j][i] <=255:
          r_arr[j][i] = 0.8
        else:                 
          r_arr[j][i]=0.9

    elif(86<= h[j][i] <=154):   # h3
      if 128 <= s[j][i] <= 255:
        if 128 <= v[j][i] <=255:
          r_arr[j][i] = 1.0
        else:                 
          r_arr[j][i]=1.1
      else:                   
        if 128 <= v[j][i] <=255:
          r_arr[j][i] = 1.2
        else:                 
          r_arr[j][i]=1.3
```

```python
<ì±„ë„ì™€ ëª…ë„ ëª¨ë‘ 255ë¶€í„° 28ì”© ì¤„ì–´ê°€ë„ë¡í•˜ì—¬ 9ê°œì˜ ë²”ì£¼ ìƒì„±í•˜ê³ 
	ë‹¤ì‹œ ê³ ì±„ë„, ê³ ëª…ë„ ìˆœìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ì´ 81ê°œì˜ ë²”ì£¼ë¥¼ 
	ë†’ì€ ìŒì˜ pitchë¶€í„° ì—°ê²°ì‹œì¼°ë‹¤.>

tp_arr = [255,226,197,168,139,110,81,52,23] #matching s,v about pitch 
p_arr = np.zeros((3,10))  #pitch array

for p in range(0,3):
  for k in range (0,10):
    for m in range(0,9):   #s:ì±„ë„
      for n in range(0,9):  #v:ëª…ë„
        if (tp_arr[m]-28) <= s[p][k] <= tp_arr[m]:
            if (tp_arr[n]-28) <= v[p][k] <= tp_arr[n]:
              p_arr[p][k]= 106 - ((m+1)*(n+1))
```

```python
<note sequence ì‘ì„± ì½”ë“œ>

p_arr = np.int64(p_arr) #type ë³€í™˜

start = 0.0
for i in range (0,10):
  my_music.notes.add( pitch = p_arr[0][i], start_time= start , end_time= start + r_arr[0][i], program=0, velocity=80)
  start = start +r_arr[0][i]

start = 0.0
for i in range (0,10):
  my_music.notes.add( pitch = p_arr[1][i], start_time= start , end_time= start + r_arr[1][i] ,program=0, velocity=80)
  start = start +r_arr[1][i]

start = 0.0
for i in range (0,10):
  my_music.notes.add( pitch = p_arr[2][i], start_time= start , end_time= start + r_arr[2][i] ,program=0, velocity=80)
  start = start +r_arr[2][i]

my_music.tempos.add(qpm=60);

# This is a colab utility method that visualizes a NoteSequence.
note_seq.plot_sequence(my_music)

# This is a colab utility method that plays a NoteSequence.
note_seq.play_sequence(my_music,synth=note_seq.fluidsynth)
```

### ì¶œì²˜ì— ëŒ€í•œ ì°¸ê³  ë¬¸í—Œ ëª©ë¡

**note-sequenceì— ê´€í•œ ë³€ìˆ˜ ì„¤ëª… github**

[https://github.com/magenta/note-seq/blob/main/note_seq/protobuf/music.proto#L27](https://github.com/magenta/note-seq/blob/main/note_seq/protobuf/music.proto#L27)

**hsv ìƒ‰ìƒí‘œ ë¶„ì„ ê´€ë ¨ ë¬¸í—Œ**

[https://subscription.packtpub.com/book/data/9781789537147/1/ch01lvl1sec09/object-detection-using-color-in-hsv](https://subscription.packtpub.com/book/data/9781789537147/1/ch01lvl1sec09/object-detection-using-color-in-hsv)

### ëŠë‚€ì 

êµ¬í˜„í•˜ê³ ì í•˜ëŠ” ê¸°ëŠ¥ì— ë§ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ëŠ” ê²ƒì´ ì²˜ìŒ ë§ë”±ëœ¨ë¦° ë‚œê´€ì´ì˜€ê³ , ê·¸ ë‹¤ìŒì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ë³€ìˆ˜ë¥¼ í•´ì„í•˜ëŠë¼ ì‹œê°„ì„ ë³´ëƒˆì—ˆëŠ”ë°, ë¬´ì—‡ë³´ë‹¤ ì–´ë ¤ì›€ì„ ê²ªì—ˆë˜ íŒŒíŠ¸ëŠ” ìƒ‰ìƒ ì°¨ì›ì„ ì†Œë¦¬ ì°¨ì›ìœ¼ë¡œ ì˜®ê¸°ëŠ” ê³¼ì •ì´ì—ˆë‹¤. 

ìƒ‰ìƒ, ëª…ë„, ì±„ë„ë¥¼ ì¶”ì¶œí•˜ê³  ê°ì •ê³¼ì˜ ìƒê´€ ê´€ê³„ë¥¼ í† ëŒ€ë¡œ ì—°ê²° ì§“ê³ ì í•˜ì˜€ìœ¼ë‚˜, ë³µí•©ì ì¸ ìƒê´€ ê´€ê³„ë¥¼ ê°€ì§„ íƒ“ì— H, S, V ì¤‘ ì–´ëŠ ê²ƒì„ ìš°ì„ ìœ¼ë¡œ ë‘ì–´ ë§¤ì¹­í•  ê²ƒì¸ê°€ì— ëŒ€í•œ ê³ ë¯¼ì´ ê°€ì¥ ì»¸ë‹¤.  ê° ë¶„ì•¼ì— ëŒ€í•œ ì „ë¬¸ ì§€ì‹ì˜ ë¶€ì¡±ìœ¼ë¡œ í˜‘ì—…ì˜ í•„ìš”ì„±ì„ ì ˆì‹¤íˆ ëŠë¼ê²Œ ë˜ì—ˆë‹¤. 
ì—¬ë ¥ì´ ëœë‹¤ë©´, ì¡°ê¸ˆ ë” ì²´ê³„ì ì¸ ê·¼ê±°ë¥¼ í† ëŒ€ë¡œ ì½”ë“œë¥¼ ë‹¤ë“¬ê³ , ê·¸ë¦¼ì—ì„œ ì—£ì§€ê¹Œì§€ ê²€ì¶œí•˜ì—¬ ìŒì•…ì  ìš”ì†Œì™€ ì—°ê²°í•œ ë‹¤ìŒ, ì‹¤ì œ ì‚¬ìš©ìë“¤ì´ ì´ìš©í•  ìˆ˜ ìˆëŠ” ì›¹í˜ì´ì§€ë¡œ êµ¬ì„±í•˜ê³  ì‹¶ì€ ë°”ëŒì´ ìˆë‹¤.

ê·¸ëŸ¼ì—ë„ ì´ë²ˆ ìˆ˜ì—…ì„ í†µí•´ ì—¬ëŸ¬ê°€ì§€ ë¼ì´ì„ ìŠ¤ì— ëŒ€í•œ ì •ë³´ì™€ ì˜¤í”ˆì†ŒìŠ¤ í™œìš©ë²•ì— ëŒ€í•œ ê¸°ì´ˆì ì¸ ì§€ì‹ì„ ìµí ìˆ˜ ìˆì–´ì„œ ë„ì›€ì´ ë˜ì—ˆë‹¤.